{% extends 'base.html' %}
{% load bootstrap4 %}
{% load crispy_forms_tags %}
{% load urlify  %}

{% block head_title %}
{{block.super}} | {{instance.title}}
{% endblock head_title %}


{% block content %}

<div class="container">
   <div class="row">
      <div class="col-lg-6 col-md-6 col-sm-12 mx-auto mt-4">
         <div class="bg-blog p-3 mt-3 mb-3">
            <div>
               <div class="author-image comment-user d-flex flex-row">
                  <div class="profile">
                     {% if comment.user.profile.image %}
                     <a href="{% url 'accounts:profile' comment.user %}">
                        <img class="profile-image" src="{{ comment.user.profile.image.url }}" alt="{{ comment.user }}"
                           title="{{ comment.user }}">
                     </a>
                     {% endif %}
                  </div>
                  <div class="author-name">
                     <a href="{% url 'accounts:profile' comment.user %}">
                        <h6>{{ comment.user }}</h6>
                     </a>
                  </div>
               </div>
               <small>{{ comment.publish_at }}</small>
               <p>{{ comment.get_markdown }}</p>
               <a href="#" class="comment-reply-btn-thread">
                  {% if comment.children.count > 0 %}
                  {{ comment.children.count }} تعليقا
                  {% elif comment.children.count == 0 %} 0 تعليقا
                  {% endif %}
                  <span class="slah">|</span>
                  رد

                  {% if request.user == comment.user %}
                  <span class="slah">|</span><a href="{{ comment.get_delete_url }}">
                     مسح
                  </a>
                  {% endif %}

               </a>
            </div>

            <div id="y">
               {% include "comments/replay-comment.html" %}
            </div>

         </div>

      </div>

   </div>
</div>
{% endblock content %}



{% block javascripts %}
<script>
   $(document).ready(function () {





      // using jQuery
      function getCookie(name) {
         var cookieValue = null;
         if (document.cookie && document.cookie !== '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
               var cookie = jQuery.trim(cookies[i]);
               // Does this cookie string begin with the name we want?
               if (cookie.substring(0, name.length + 1) === (name + '=')) {
                  cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                  break;
               }
            }
         }
         return cookieValue;
      }

      var csrftoken = getCookie('csrftoken');

      function csrfSafeMethod(method) {
         // these HTTP methods do not require CSRF protection
         return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
      }
      $.ajaxSetup({
         beforeSend: function (xhr, settings) {
            if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
               xhr.setRequestHeader("X-CSRFToken", csrftoken);
            }
         }
      });








      $(document).on('submit', "#reply-form", function (event) {
         event.preventDefault();
         var form = $("#reply-form");
         var formData = form.serialize();
         var thisURL = form.attr('data-url') || window.location.href // or set your own url
         $.ajax({
            type: "POST",
            url: thisURL,
            data: formData,
            cache: false,
            dataType: 'json',
            success: function (data) {
               data = data['form']
               $("#y").html(data);
               $("textarea").val(' ');

            },
            error: function (e) {
               console.log(e);
            },

         });
         //return false;
      });


   });
</script>

{% endblock javascripts %}